{
  "scenario_name": "scenario_113_capped_rotation",
  "inputs": {
    "portfolio_snapshot": {
      "portfolio_id": "pf_113",
      "base_currency": "SGD",
      "positions": [
        {
          "instrument_id": "USD_OLD",
          "quantity": "100",
          "market_value": null
        }
      ],
      "cash_balances": [
        {
          "currency": "SGD",
          "amount": "0.0",
          "settled": null,
          "pending": null
        },
        {
          "currency": "USD",
          "amount": "0.0",
          "settled": null,
          "pending": null
        },
        {
          "currency": "EUR",
          "amount": "0.0",
          "settled": null,
          "pending": null
        }
      ]
    },
    "market_data_snapshot": {
      "prices": [
        {
          "instrument_id": "USD_OLD",
          "price": "100.0",
          "currency": "USD"
        },
        {
          "instrument_id": "USD_NEW",
          "price": "100.0",
          "currency": "USD"
        },
        {
          "instrument_id": "EUR_NEW",
          "price": "100.0",
          "currency": "EUR"
        }
      ],
      "fx_rates": [
        {
          "pair": "USD/SGD",
          "rate": "1.5"
        },
        {
          "pair": "EUR/SGD",
          "rate": "1.6"
        }
      ]
    },
    "model_portfolio": {
      "targets": [
        {
          "instrument_id": "USD_NEW",
          "weight": "0.5"
        },
        {
          "instrument_id": "EUR_NEW",
          "weight": "0.5"
        }
      ]
    },
    "shelf_entries": [
      {
        "instrument_id": "USD_OLD",
        "status": "APPROVED",
        "asset_class": "UNKNOWN",
        "min_notional": null
      },
      {
        "instrument_id": "USD_NEW",
        "status": "APPROVED",
        "asset_class": "UNKNOWN",
        "min_notional": null
      },
      {
        "instrument_id": "EUR_NEW",
        "status": "APPROVED",
        "asset_class": "UNKNOWN",
        "min_notional": null
      }
    ],
    "options": {
      "allow_restricted": false,
      "suppress_dust_trades": true,
      "dust_trade_threshold": null,
      "fx_buffer_pct": "0.01",
      "single_position_max_weight": "0.30",
      "block_on_missing_prices": true,
      "min_cash_buffer_pct": "0.0"
    }
  },
  "expected_outputs": {
    "rebalance_run_id": "rr_golden",
    "correlation_id": "c_placeholder",
    "status": "PENDING_REVIEW",
    "before": {
      "total_value": {
        "amount": "15000.00",
        "currency": "SGD"
      },
      "cash_balances": [
        {
          "currency": "SGD",
          "amount": "0.0",
          "settled": null,
          "pending": null
        },
        {
          "currency": "USD",
          "amount": "0.0",
          "settled": null,
          "pending": null
        },
        {
          "currency": "EUR",
          "amount": "0.0",
          "settled": null,
          "pending": null
        }
      ],
      "positions": [
        {
          "instrument_id": "USD_OLD",
          "quantity": "100",
          "instrument_currency": "USD",
          "price": {
            "amount": "100.0",
            "currency": "USD"
          },
          "value_in_instrument_ccy": {
            "amount": "10000.0",
            "currency": "USD"
          },
          "value_in_base_ccy": {
            "amount": "15000.00",
            "currency": "SGD"
          },
          "weight": "1"
        }
      ],
      "allocation_by_asset_class": [
        {
          "key": "CASH",
          "weight": "0",
          "value": {
            "amount": "0.00",
            "currency": "SGD"
          }
        },
        {
          "key": "UNKNOWN",
          "weight": "1",
          "value": {
            "amount": "15000.00",
            "currency": "SGD"
          }
        }
      ],
      "allocation_by_instrument": [
        {
          "key": "USD_OLD",
          "weight": "1",
          "value": {
            "amount": "15000.00",
            "currency": "SGD"
          }
        }
      ],
      "allocation": [
        {
          "key": "CASH",
          "weight": "0",
          "value": {
            "amount": "0.00",
            "currency": "SGD"
          }
        },
        {
          "key": "UNKNOWN",
          "weight": "1",
          "value": {
            "amount": "15000.00",
            "currency": "SGD"
          }
        }
      ]
    },
    "universe": {
      "universe_id": "uni_golden",
      "eligible_for_buy": [
        "USD_NEW",
        "EUR_NEW"
      ],
      "eligible_for_sell": [
        "USD_NEW",
        "EUR_NEW",
        "USD_OLD"
      ],
      "excluded": [],
      "coverage": {
        "price_coverage_pct": "1",
        "fx_coverage_pct": "1"
      }
    },
    "target": {
      "target_id": "tgt_golden",
      "strategy": {},
      "targets": [
        {
          "instrument_id": "USD_NEW",
          "model_weight": "0.5",
          "final_weight": "0.30",
          "final_value": {
            "amount": "4500.0000",
            "currency": "SGD"
          },
          "tags": [
            "CAPPED_BY_MAX_WEIGHT"
          ]
        },
        {
          "instrument_id": "EUR_NEW",
          "model_weight": "0.5",
          "final_weight": "0.30",
          "final_value": {
            "amount": "4500.0000",
            "currency": "SGD"
          },
          "tags": [
            "CAPPED_BY_MAX_WEIGHT"
          ]
        },
        {
          "instrument_id": "USD_OLD",
          "model_weight": "0.0",
          "final_weight": "0.0",
          "final_value": {
            "amount": "0.000",
            "currency": "SGD"
          },
          "tags": [
            "IMPLICIT_SELL_TO_ZERO"
          ]
        }
      ]
    },
    "intents": [
      {
        "intent_id": "oi_3",
        "intent_type": "SECURITY_TRADE",
        "side": "SELL",
        "instrument_id": "USD_OLD",
        "quantity": "100",
        "notional": {
          "amount": "10000.0",
          "currency": "USD"
        },
        "pair": null,
        "buy_currency": null,
        "buy_amount": null,
        "sell_currency": null,
        "estimated_sell_amount": null,
        "dependencies": [],
        "rationale": {
          "code": "DRIFT_REBALANCE",
          "message": "Align to model target"
        }
      },
      {
        "intent_id": "oi_fx_4",
        "intent_type": "FX_SPOT",
        "side": "SELL_BASE_BUY_QUOTE",
        "instrument_id": null,
        "quantity": null,
        "notional": null,
        "pair": "USD/SGD",
        "buy_currency": "SGD",
        "buy_amount": "10500.00",
        "sell_currency": "USD",
        "estimated_sell_amount": "7000.0",
        "dependencies": [],
        "rationale": {
          "code": "REPATRIATION",
          "message": "Sweep excess cash to base"
        }
      },
      {
        "intent_id": "oi_fx_5",
        "intent_type": "FX_SPOT",
        "side": "BUY_BASE_SELL_QUOTE",
        "instrument_id": null,
        "quantity": null,
        "notional": null,
        "pair": "EUR/SGD",
        "buy_currency": "EUR",
        "buy_amount": "2828.000",
        "sell_currency": "SGD",
        "estimated_sell_amount": "4524.8000",
        "dependencies": [],
        "rationale": {
          "code": "FUNDING",
          "message": "Fund foreign buys"
        }
      },
      {
        "intent_id": "oi_1",
        "intent_type": "SECURITY_TRADE",
        "side": "BUY",
        "instrument_id": "USD_NEW",
        "quantity": "30",
        "notional": {
          "amount": "3000.0",
          "currency": "USD"
        },
        "pair": null,
        "buy_currency": null,
        "buy_amount": null,
        "sell_currency": null,
        "estimated_sell_amount": null,
        "dependencies": [
          "oi_3"
        ],
        "rationale": {
          "code": "DRIFT_REBALANCE",
          "message": "Align to model target"
        }
      },
      {
        "intent_id": "oi_2",
        "intent_type": "SECURITY_TRADE",
        "side": "BUY",
        "instrument_id": "EUR_NEW",
        "quantity": "28",
        "notional": {
          "amount": "2800.0",
          "currency": "EUR"
        },
        "pair": null,
        "buy_currency": null,
        "buy_amount": null,
        "sell_currency": null,
        "estimated_sell_amount": null,
        "dependencies": [
          "oi_fx_5"
        ],
        "rationale": {
          "code": "DRIFT_REBALANCE",
          "message": "Align to model target"
        }
      }
    ],
    "after_simulated": {
      "total_value": {
        "amount": "15000.00000",
        "currency": "SGD"
      },
      "cash_balances": [
        {
          "currency": "SGD",
          "amount": "5975.2000",
          "settled": null,
          "pending": null
        },
        {
          "currency": "USD",
          "amount": "0.0",
          "settled": null,
          "pending": null
        },
        {
          "currency": "EUR",
          "amount": "28.000",
          "settled": null,
          "pending": null
        }
      ],
      "positions": [
        {
          "instrument_id": "USD_NEW",
          "quantity": "30",
          "instrument_currency": "USD",
          "price": {
            "amount": "100.0",
            "currency": "USD"
          },
          "value_in_instrument_ccy": {
            "amount": "3000.0",
            "currency": "USD"
          },
          "value_in_base_ccy": {
            "amount": "4500.00",
            "currency": "SGD"
          },
          "weight": "0.3"
        },
        {
          "instrument_id": "EUR_NEW",
          "quantity": "28",
          "instrument_currency": "EUR",
          "price": {
            "amount": "100.0",
            "currency": "EUR"
          },
          "value_in_instrument_ccy": {
            "amount": "2800.0",
            "currency": "EUR"
          },
          "value_in_base_ccy": {
            "amount": "4480.00",
            "currency": "SGD"
          },
          "weight": "0.2986666666666666666666666667"
        }
      ],
      "allocation_by_asset_class": [
        {
          "key": "CASH",
          "weight": "0.4013333333333333333333333333",
          "value": {
            "amount": "6020.00000",
            "currency": "SGD"
          }
        },
        {
          "key": "UNKNOWN",
          "weight": "0.5986666666666666666666666667",
          "value": {
            "amount": "8980.00",
            "currency": "SGD"
          }
        }
      ],
      "allocation_by_instrument": [
        {
          "key": "USD_NEW",
          "weight": "0.3",
          "value": {
            "amount": "4500.00",
            "currency": "SGD"
          }
        },
        {
          "key": "EUR_NEW",
          "weight": "0.2986666666666666666666666667",
          "value": {
            "amount": "4480.00",
            "currency": "SGD"
          }
        }
      ],
      "allocation": [
        {
          "key": "CASH",
          "weight": "0.4013333333333333333333333333",
          "value": {
            "amount": "6020.00000",
            "currency": "SGD"
          }
        },
        {
          "key": "UNKNOWN",
          "weight": "0.5986666666666666666666666667",
          "value": {
            "amount": "8980.00",
            "currency": "SGD"
          }
        }
      ]
    },
    "rule_results": [
      {
        "rule_id": "CASH_BAND",
        "severity": "SOFT",
        "status": "FAIL",
        "measured": "0.4013333333333333333333333333",
        "threshold": {
          "max": "0.05"
        },
        "reason_code": "THRESHOLD_BREACH",
        "remediation_hint": null
      }
    ],
    "explanation": {
      "summary": "Status: PENDING_REVIEW"
    },
    "diagnostics": {
      "warnings": [],
      "suppressed_intents": [],
      "data_quality": {
        "price_missing": [],
        "fx_missing": [],
        "shelf_missing": []
      }
    },
    "lineage": {
      "portfolio_snapshot_id": "pf_113",
      "market_data_snapshot_id": "md",
      "request_hash": "hash_golden"
    }
  }
}